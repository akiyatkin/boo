# Группы кэша
Расширение разрабатывалось в перую очередь для работы с удалёнными хранилищами, такими как Google Drive или Google Docs. Обращение, к которым требует значительного времени. Данное решение не предназначено для хранения больших объёмов данных. 

Рекомендуется использовать расширение на небольших сайтах (10 000 кэшей), когда администратор вносит изменения в удалённом хранилище и сбросив нужный кэш сразу проверяет изменеyия сайта.

Данное расширение целесообразно применять в тех случаях, когда нет возможности настроить обратную связь с автоматическим обновлением кэша при обновлении удалённого хранилища. ```Boo``` ручное изирательное управление кэшем является ключевой особенностью данного решения.

Поддерживаются вложенные кэши и разные места обращения, когда в дереве зависимостей у экземпляра кэша несколько родителей. Во всех случае кэшируемая функция выполняется один раз и при обновлении зависимостей обновляются и все родители.

## Установка через composer

```
{
	"require":{
		"akiyatkin/boo":"~1"
	}
}
```
1. Должен быть **.htaccess** с настроенной переадресацией для адресов начинающихся с символов ```!~-``` согласно правилам [infrajs/router](https://github.com/infrajs/router), чтобы в пропкте работал адрес /-boo/. Совместим с любыми другими роутерами не использующими символы ```!~-``` как специальные. Проект должен находиться в корне домена или виртуального хоста.
```
RewriteEngine on
RewriteCond %{REQUEST_URI} ^/[-~\!]
RewriteRule ^(.*)$ vendor/infrajs/router/index.php [L,QSA]
```

2. Нужно настроить права для упраления кэшем и создать в корне проекта конфигурационный файл **.infra.json**. Для сервера 127.0.0.1 разрешение есть автоматически, но на других серверах нужно будет указать ip адрес в секции access.test или ```true``` для общего доступа к управлению кэшем, согласно правилам расширения [infrajs/access](https://github.com/infrajs/access).

3. В скрипте, который работает с расширением Boo рабочая дирректория должна вести на корень проекта. Если скрипт лежит во вложенной папке должна быть команда ```chdir('../');``` согласно требованиям [infrajs/path](https://github.com/infrajs/path)

4. Для того чтобы работал параметр ```?-boo``` в адресной строке скрипта требуется выполнение ```Router::init()```, или обращение по адресу с символом **-**, тогда роутер подключается автоматически и рабочую дирректрию также не нужно менять она всегда будет от корня, вне зависимости от расположения файла скрипта.

```json
{
	"access":{
		"test":true
	}
}
```

## Использование

```
$args = array($one, $two); //простые, необязательные параметры идентифицирующие кэш
$data = Boo::cache(['cache-group-id','group-title'], function($one, $two){
	
	$data = sleep(5); //Что-то долгое
	
	//$one и $two чаще всего какие-то идентификаторы.
	//Можно указать более понятный title для кэша текущей обработки
	Boo::setTitle($title);
	
	return $data; //нерекурсивные кэшируемые данные
	
}, $args);
``` 
Функция сохраняет кэши и позволяет выборочно обновлять их по адресу ```/-boo/``` (С правами тестировщика [infrajs/access](https://github.com/infrajs/access) и настроенным роутером [infrajs/router](https://github.com/infrajs/router)) 

## Записки разработчика
Кэш сохраняется в на жёстком диске в папке ```!boo/```. Описание всех кэш-элементов хранится в ```!boo/.tree.json```. Дерево кэш-зависимостей строится по childs без parents. Причина хранения childs, а не parents, в том что все childs определяются сразу, а родители могут появляться с течением времени при следующих запросах.

## Контакты
Обсудить расширение и задать вопрос можно в группе ВКонтакте [https://vk.com/infrajs](https://vk.com/infrajs)
